<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android 绘图 ——Android群英传 学习笔记 | 寸草金的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="FontMatrics部分参考：http://mikewang.blog.51cto.com/3826268/871765 核心类 1.Canvas 画布 2.Bitmap 纸 3.Paint 笔 4.｛     FontMetrics     PorterDuffXfermode     Matrix(3x3矩阵)      ColorMatrix(4x5矩阵)     ColorFilter">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 绘图 ——Android群英传 学习笔记">
<meta property="og:url" content="http://yoursite.com/2017/08/02/绘图/index.html">
<meta property="og:site_name" content="寸草金的博客">
<meta property="og:description" content="FontMatrics部分参考：http://mikewang.blog.51cto.com/3826268/871765 核心类 1.Canvas 画布 2.Bitmap 纸 3.Paint 笔 4.｛     FontMetrics     PorterDuffXfermode     Matrix(3x3矩阵)      ColorMatrix(4x5矩阵)     ColorFilter">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-12-18T16:39:28.885Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 绘图 ——Android群英传 学习笔记">
<meta name="twitter:description" content="FontMatrics部分参考：http://mikewang.blog.51cto.com/3826268/871765 核心类 1.Canvas 画布 2.Bitmap 纸 3.Paint 笔 4.｛     FontMetrics     PorterDuffXfermode     Matrix(3x3矩阵)      ColorMatrix(4x5矩阵)     ColorFilter">
  
    <link rel="alternate" href="/atom.xml" title="寸草金的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">寸草金的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-绘图" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/02/绘图/" class="article-date">
  <time datetime="2017-08-02T02:21:02.425Z" itemprop="datePublished">2017-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android 绘图 ——Android群英传 学习笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>FontMatrics部分参考：<a href="http://mikewang.blog.51cto.com/3826268/871765" target="_blank" rel="external">http://mikewang.blog.51cto.com/3826268/871765</a></p>
<p><strong>核心类</strong></p>
<pre><code>1.Canvas 画布
2.Bitmap 纸
3.Paint 笔
4.｛
    FontMetrics
    PorterDuffXfermode
    Matrix(3x3矩阵) 
    ColorMatrix(4x5矩阵)
    ColorFilter
    Shader
    PathEffect
｝
5. SurfaceView P155，有固定模版用法
</code></pre><p><strong>思想</strong></p>
<pre><code>1.一般初始化Canvas时，要传入一个Bitmap，之后的所有的绘制效果都将呈现在Bitmap上。
    Bitmap mPaper = Bitmap.createBitmap(bm.getWidth(), bm.getHeight(), Bitmap.Config.ARGB_8888);
    mCanvas = new Canvas(mPaper);
    mCanvas.drawBitmap(bm, 0, 0, paint);//将bm用画笔paint画到mPager上
2.在onDraw(canvas)方法中，只需要将步骤1中的纸mPaper绘制到系统提供的画布canvas上即可。
    canvas.drawBitmap(mPaper, 0, 0, null);
3.Paint 
    具有非常强大的功能：
    1）PorterDuffXfermode 滤镜功能：
        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_IN));
        mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_OUT));
        设置混合模式，具体效果参考文档，或Android群英传P146.
    2）获取FontMetrics，测量文本尺寸
        Paint.FontMetrics fm = mPaint.getFontMetrics();
        FontMetrics属性：｛
            1. 基准点是baseline
            2. ascent是baseline之上至字符最高处的距离
            3. descent是baseline之下至字符最低处的距离
            4. leading文档说的很含糊，其实是上一行字符的descent到下一行的ascent之间的距离
            5. top指的是指的是最高字符到baseline的值，即ascent的最大值
            6. 同上，bottom指的是最下字符到baseline的值，即descent的最大值

            说明：ascent/descent/top/bottom，这几个值均表示距离baseline的距离。举例：ascent的值，即为字符最高处的y坐标减去baseline的y坐标之差。所以，其永远为负值。同理，descent/bottom永远为正值。
        ｝

        float baseY = - fm.top;
        mCanvas.drawText(&quot;cuncaojin&quot;, 0, baseY, mPaint);

        ![](http://img1.51cto.com/attachment/201205/204735397.png)
    3）Style（空心/实心）
            mPaint.setStyle(Paint.Style.FILL);
            mPaint.setStyle(Paint.Style.STROKE);
            mPaint.setStyle(Paint.Style.FILL_AND_STROKE);
    4）setColorFilter
        ColorMatrix imageMatrix = new ColorMatrix();
        //颜色矩阵，可以设置色调、饱和度、亮度
        imageMatrix.setRotate(0/1/2,hue);//0,1,2——R，G，B 色调
        imageMatrix.setSaturation(saturation);//饱和度为0时，图像为灰度图像
        imageMatrix.setScale(lum, lum, lum, 1);//亮度
        imageMatrix.postConcat(anotherColorMatrix);//将颜色矩阵叠加
        paint.setColorFilter(new ColorMatrixColorFilter(imageMatrix));

    5）setShader（）：主要作用是作为遮罩层，产生特殊效果
        Shader（渲染器）类实现类有{
            a. BitmapShader 位图Shader （相比其他Shader比较特殊）
                {
                    用BitmapShader填充时的3种模式：
                        CLAMP 拉伸
                        REPEAT 重复
                        MIRROR 镜像
                }
            b. LinearGradient 线性Shader
            c. RadialGradient 光束Shader
            d. SweepGradient 梯度Shader
            e. ComposeShader 混合Shader
        }


    6）setPathEffect 路径效果
        a. null    
        b. CornerPathEffect    路径圆滑处理
        c. DiscretePathEffect    产生杂点
        d. DashPathEffect    虚线化
        e. PathDashPathEffect    可设置虚线图形
        f. ComposePathEffect    可组合以上效果


    7）其他属性｛
        setAntiAlias（true）； 抗锯齿
        setStrokeJoin(Paint.Join.ROUND); 设置笔连接处圆滑处理
        setStrokeCap(Paint.Cap.ROUND); 设置笔触圆滑处理
        setStrokeWidth(50);    设置笔宽
        setColor（）；    
        setARGB（）；
        setAlpah（）；
        setTextSize（）；
    ｝    
4.Canvas
    1）绘制｛
        drawPoint
        drawLine
        drawRect
        drawRoundRect
        drawArc 绘制扇形或弧形（由参数useCenter决定，true扇形，false弧形，设置Paint.Style决定是空心还是实心）
        drawOval 绘制椭圆
        drawText 
        drawPosText（text, new float[]{x1,y1,x2,y2,...xn,yn}, paint） 在指定位置逐个对每个字符绘制    
        drawPath 绘制路径
        drawBitmap
    ｝
    2）结合Matrix
        Matrix matrix = new Matrix();
        matrix{
            setRotate()
            setTranslate();    
            setScale();    
            setSkew(); 错切变换/剪切变换
            pre() 先乘
            post() 后乘
        }
        canvas.drawBitmap(mBitmap, matrix ,null);
        ---------------------------------------------
        Canvas mCanvas = new Canvas(mBmp);
        Matrix matrix = new Matrix();
        float scale = w * 1f / getResources().getDisplayMetrics().widthPixels;
        matrix.setScale(scale, scale);
        mCanvas.drawBitmap(bitmap, matrix, mPaint);
    3）Canvas的其他方法｛
        save（） 将之前绘制的所有图像进行保存
        restore() 将save()之后绘制的所有图像与save（）之前的图像进行合并
        translate（） 
        rotate（）
    ｝
</code></pre><p><strong>Demo:</strong></p>
<pre><code>自定义一个圆形图，实现方案｛
    1）使用paint.setXferMode(new PorterXferMode(...))
        a. 绘制圆
        b. 对画笔设置PorterDuffXfermode（SRC_IN）则上步绘制的圆作为遮罩层
        c. （设置缩放比例等）优化绘图效果
        d. 绘制图片
    2） 使用paint.setShader(new BitmapShader(...))
        a. 对画笔设置渲染器为BitmapShader,模式选择拉伸
            mPaint.setShader(new BitmapShader(mBmp, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP));
        b. （设置缩放比例等）优化绘图效果
        c. 绘制圆
｝
</code></pre><p><strong>参考代码如下：</strong></p>
<pre><code>方案一：
public CircleView(Context context, AttributeSet attrs) {
    super(context, attrs);
    init();

    TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.CircleView);
    int indexCount = typedArray.getIndexCount();
    for (int i = 0; i &lt; indexCount; i++) {
        int index = typedArray.getIndex(i);
        switch (index) {
            case R.styleable.CircleView_src:

                BitmapDrawable drawable = (BitmapDrawable) typedArray.getDrawable(index);
                mBitmap = drawable.getBitmap();
                break;
        }
    }
    typedArray.recycle();
}

private void init() {
    mPaint = new Paint();
    mPaint.setAntiAlias(true);
    mPaint.setStrokeJoin(Paint.Join.ROUND);
}

@Override
protected void onSizeChanged(int w, int h, int oldw, int oldh) {
    super.onSizeChanged(w, h, oldw, oldh);

    mPaper = Bitmap.createBitmap(w, w, Bitmap.Config.ARGB_8888);
    mCanvas = new Canvas(mPaper);
    mPaint.setTextSize(50);
    mPaint.setStrokeWidth(5);
    mPaint.setARGB(255, 255, 0, 0);
    mPaint.setColor(0xff00ff00);
    mPaint.setTextAlign(Paint.Align.LEFT);

    Paint.FontMetrics fm = mPaint.getFontMetrics();
    Log.i(&quot;tag&quot;, fm.ascent + &quot;, leading:&quot; + fm.leading + &quot; ,descent:&quot; + fm.descent + &quot;, bottom:&quot; + fm.bottom + &quot;, &quot; + fm.top);
    float baseY = -fm.ascent;
    mCanvas.drawText(&quot;寸草金CUNJQjinsdaofihwafehofdmvpBGEOUWmevldnbuehwPOS:lXM&quot;, 0, baseY, mPaint);

    Path path = new Path();
    path.moveTo(0, 50);
    path.lineTo(100, 200);
    mCanvas.drawPath(path, mPaint);

    mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_OUT));

    RectF rect = new RectF(0, 0, w, h);
    mCanvas.drawRoundRect(rect, 50, 50, mPaint);

    mPaint.setXfermode(new PorterDuffXfermode(PorterDuff.Mode.SRC_IN));

    Matrix matrix = new Matrix();
    matrix.setScale(w * 1f / mBitmap.getWidth(), w * 1f / mBitmap.getWidth());
    mCanvas.drawBitmap(mBitmap, matrix, mPaint);
}
</code></pre><hr>
<pre><code>方案二：
private void init(Context context, AttributeSet attrs) {
    mPaint = new Paint();
    mPaint.setAntiAlias(true);
    mPaint.setStrokeJoin(Paint.Join.ROUND);
    mPaint.setStrokeCap(Paint.Cap.ROUND);
}

@Override
protected void onSizeChanged(int w, int h, int oldw, int oldh) {
    super.onSizeChanged(w, h, oldw, oldh);
    Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.pic1);
    mBmp = Bitmap.createBitmap(w, w, Bitmap.Config.ARGB_8888);

    Canvas mCanvas = new Canvas(mBmp);
    Matrix matrix = new Matrix();
    float scale = w * 1f / getResources().getDisplayMetrics().widthPixels;
    matrix.setScale(scale, scale);
    mCanvas.drawBitmap(bitmap, matrix, mPaint);

    mPaint.setShader(new BitmapShader(mBmp, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP));
}

@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
    setMeasuredDimension(widthMeasureSpec, widthMeasureSpec);
}

@Override
protected void onDraw(Canvas canvas) {
    super.onDraw(canvas);
    int r = getWidth() / 2;
    canvas.drawCircle(r, r, r, mPaint);
}
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/02/绘图/" data-id="cj5wh4ryl000kdsrrf5f1uazk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/08/02/Android动画的7种实现方式/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android Scroll分析 ——《群英传》第五章
        
      </div>
    </a>
  
  
    <a href="/2017/08/02/蚂蚁金服开放平台 RSA2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">蚂蚁金服. 开放平台. 文档中心</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/02/Android动画的7种实现方式/">Android Scroll分析 ——《群英传》第五章</a>
          </li>
        
          <li>
            <a href="/2017/08/02/绘图/">Android 绘图 ——Android群英传 学习笔记</a>
          </li>
        
          <li>
            <a href="/2017/08/02/蚂蚁金服开放平台 RSA2/">蚂蚁金服. 开放平台. 文档中心</a>
          </li>
        
          <li>
            <a href="/2017/08/02/MVP/">MVP学习笔记</a>
          </li>
        
          <li>
            <a href="/2017/08/02/HttpURLConnection重定向/">URL由http到https重定向，URLConnection下载失败</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 cuncaojin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>